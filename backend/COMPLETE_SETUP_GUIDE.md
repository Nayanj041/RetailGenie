# 🚀 RetailGenie Backend - Complete Setup Guide

This guide will walk you through setting up the RetailGenie backend with all advanced features enabled, including AI assistant, inventory optimization, sentiment analysis, and more.

## 🎯 Quick Start

### 1. Prerequisites Check
```bash
# Check Python version (3.8+ required)
python3 --version

# Check if Git is installed
git --version
```

### 2. Clone and Setup
```bash
# If not already done
git clone <your-repo-url>
cd RetailGenie/backend

# Run the automated setup
./setup_environment.sh
```

### 3. Configure Environment Variables
```bash
# Edit the generated .env file
nano .env

# See the detailed guide
cat docs/ENVIRONMENT_VARIABLES_GUIDE.md
```

### 4. Install Dependencies
```bash
# Install Python packages
pip install -r requirements.txt

# Install Redis (if not already installed)
# Ubuntu/Debian:
sudo apt install redis-server
sudo systemctl start redis-server

# macOS:
brew install redis
brew services start redis
```

### 5. Validate Configuration
```bash
# Test all environment variables and services
python validate_environment.py
```

### 6. Start the Application
```bash
# Start with all features enabled
./start_enhanced.sh
```

## 🔧 Detailed Setup Instructions

### Required Environment Variables

#### 🔑 Essential (Must Configure)
- **`SECRET_KEY`** - Flask security (auto-generated by setup script)
- **`JWT_SECRET`** - JWT token security (auto-generated by setup script)
- **`FIREBASE_PROJECT_ID`** - Your Firebase project ID
- **`FIREBASE_PRIVATE_KEY`** - Firebase service account private key
- **`FIREBASE_CLIENT_EMAIL`** - Firebase service account email
- **`GEMINI_API_KEY`** - Google Gemini API key for AI features

#### 📧 For Email Features
- **`SMTP_SERVER`** - Email server (e.g., smtp.gmail.com)
- **`SENDER_EMAIL`** - Your email address
- **`SENDER_PASSWORD`** - App password or SMTP password
- **`ADMIN_EMAIL`** - Admin notification email

#### 💾 For Background Tasks
- **`REDIS_URL`** - Redis connection URL
- **`CELERY_BROKER_URL`** - Celery broker URL (usually same as Redis)
- **`CELERY_RESULT_BACKEND`** - Celery results backend

### Service Setup Guides

#### 🔥 Firebase Setup
1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Create new project (or use existing)
3. Enable Firestore Database
4. Enable Authentication with Email/Password
5. Create service account and download JSON
6. Extract values for environment variables

[📚 Detailed Firebase Guide](docs/ENVIRONMENT_VARIABLES_GUIDE.md#firebase-configuration)

#### 🤖 Google Gemini Setup
1. Go to [Google AI Studio](https://makersuite.google.com/app/apikey)
2. Create API key
3. Copy to `GEMINI_API_KEY` in .env

[📚 Detailed Gemini Guide](docs/ENVIRONMENT_VARIABLES_GUIDE.md#google-gemini-configuration)

#### 📧 Email Setup (Gmail Example)
1. Enable 2-Factor Authentication on Gmail
2. Generate App Password in Google Account settings
3. Use app password (not regular password) in `SENDER_PASSWORD`

[📚 Detailed Email Guide](docs/ENVIRONMENT_VARIABLES_GUIDE.md#email-configuration-smtp)

## 🧪 Testing Your Setup

### Run Validation Script
```bash
python validate_environment.py
```

This will test:
- ✅ Environment variables configuration
- ✅ Firebase connection
- ✅ Gemini API access
- ✅ Redis connection
- ✅ Email SMTP configuration
- ✅ Python dependencies

### Individual Component Tests

#### Test Gemini API
```bash
python test_gemini.py
```

#### Test Firebase
```bash
python -c "from app.utils.firebase_utils import FirebaseManager; fm = FirebaseManager(); print('Firebase OK!')"
```

#### Test Redis
```bash
python -c "import redis; r = redis.from_url('redis://localhost:6379/0'); r.ping(); print('Redis OK!')"
```

#### Run Full Test Suite
```bash
python -m pytest tests/ -v
```

## 🚀 Starting the Application

### Development Mode
```bash
# With auto-reload and debug mode
./start_enhanced.sh

# Or manually
python app.py
```

### Production Mode
```bash
# Using production configuration
./start_production.sh

# Or with Gunicorn
gunicorn --bind 0.0.0.0:5000 wsgi:app
```

### Background Tasks (Celery)
```bash
# Start Celery worker in another terminal
celery -A celery_app worker --loglevel=info

# Start Celery beat scheduler (for periodic tasks)
celery -A celery_app beat --loglevel=info
```

## 📋 Available Features

### ✅ Core Features
- 🔐 Authentication & Authorization (JWT + Firebase)
- 🛍️ Product Management
- 📊 Inventory Tracking
- 💰 Dynamic Pricing
- 📈 Analytics & Reporting

### ✅ Advanced AI Features
- 🤖 AI Shopping Assistant (Gemini-powered)
- 🎯 Product Recommendations
- 📝 Sentiment Analysis
- 🔄 Product Substitution Suggestions
- 🌱 Sustainability Scoring

### ✅ Smart Features
- 🎮 Gamification Dashboard
- 🎟️ Coupon Optimization
- 🗣️ Voice Assistant Integration
- 📄 PDF Report Generation
- 📧 Email Notifications

### ✅ Technical Features
- 🔄 API Versioning
- ⚡ Caching (Redis)
- 🚦 Rate Limiting
- 📊 Performance Monitoring
- 🔧 Background Task Processing

## 🌐 API Endpoints

### Authentication
- `POST /api/v1/auth/login` - User login
- `POST /api/v1/auth/register` - User registration
- `POST /api/v1/auth/logout` - User logout

### AI Assistant
- `POST /api/v1/ai/chat` - Chat with AI assistant
- `POST /api/v1/ai/analyze-sentiment` - Analyze sentiment
- `POST /api/v1/ai/recommend-products` - Get product recommendations
- `POST /api/v1/ai/substitute-product` - Find product substitutes

### Products & Inventory
- `GET /api/v1/products` - List products
- `POST /api/v1/products` - Create product
- `GET /api/v1/inventory` - Check inventory
- `POST /api/v1/inventory/optimize` - Optimize inventory

### Analytics & Pricing
- `GET /api/v1/analytics/dashboard` - Analytics dashboard
- `POST /api/v1/pricing/optimize` - Dynamic pricing
- `GET /api/v1/reports/generate` - Generate reports

### Global Features
- `POST /api/search` - Global search (all features)
- `POST /api/chat` - Global chat interface

[📚 Complete API Documentation](docs/api/)

## 🔧 Configuration Options

### Environment Modes
```bash
# Development
FLASK_ENV=development
FLASK_DEBUG=True

# Production  
FLASK_ENV=production
FLASK_DEBUG=False
```

### Feature Flags
```bash
# Enable/disable features
ENABLE_METRICS=True
ENABLE_AI_FEATURES=True
ENABLE_EMAIL_NOTIFICATIONS=True
```

### Performance Tuning
```bash
# Cache settings
CACHE_TYPE=redis  # or simple for development
CACHE_DEFAULT_TIMEOUT=300

# Rate limiting
RATELIMIT_DEFAULT=1000 per hour

# Background tasks
CELERY_WORKER_CONCURRENCY=4
```

## 🐛 Troubleshooting

### Common Issues

#### "Firebase connection failed"
- ✅ Check `FIREBASE_PROJECT_ID` matches your project
- ✅ Ensure private key format includes `\n` characters
- ✅ Verify service account has proper permissions

#### "Gemini API authentication failed"
- ✅ Verify API key is correct (no extra spaces)
- ✅ Check quota limits in Google AI Studio
- ✅ Ensure billing is enabled if using paid features

#### "Redis connection refused"
- ✅ Install Redis: `sudo apt install redis-server`
- ✅ Start Redis: `sudo systemctl start redis-server`
- ✅ Check Redis is running: `redis-cli ping`

#### "Email authentication failed"
- ✅ For Gmail: Enable 2FA and use app password
- ✅ Check SMTP server and port settings
- ✅ Verify email provider allows SMTP access

### Debug Mode
```bash
# Enable debug logging
export FLASK_DEBUG=True
export LOG_LEVEL=DEBUG

# Check application logs
tail -f logs/app.log
```

### Test Individual Components
```bash
# Test specific functionality
python -c "from app.controllers.ai_assistant_controller import AIAssistantController; print('AI Controller OK')"
```

## 📚 Documentation

- [🔧 Environment Variables Guide](docs/ENVIRONMENT_VARIABLES_GUIDE.md) - Detailed setup instructions
- [🧪 Testing Guide](docs/TESTING_GUIDE.md) - How to run tests
- [🚀 Deployment Guide](docs/guides/deployment.md) - Production deployment
- [🎯 Performance Guide](docs/PERFORMANCE_OPTIMIZATION_SUMMARY.md) - Optimization tips
- [📊 API Documentation](docs/api/) - Complete API reference

## 🤝 Getting Help

1. **Check validation script**: `python validate_environment.py`
2. **Review logs**: `tail -f logs/app.log`
3. **Test components individually** using the test commands above
4. **Check environment variables** are properly set
5. **Verify external services** (Firebase, Redis, email) are accessible

## 🎉 Success Checklist

- [ ] ✅ All environment variables configured
- [ ] ✅ Firebase project created and configured
- [ ] ✅ Gemini API key obtained and working
- [ ] ✅ Redis installed and running
- [ ] ✅ Email SMTP configured (optional)
- [ ] ✅ Python dependencies installed
- [ ] ✅ Validation script passes all tests
- [ ] ✅ Application starts without errors
- [ ] ✅ API endpoints respond correctly
- [ ] ✅ AI features working (Gemini integration)
- [ ] ✅ Background tasks processing (Celery)

## 🚀 You're Ready!

Once everything is set up and validated, your RetailGenie backend will have:

- 🤖 **Intelligent AI assistant** powered by Google Gemini
- 🛍️ **Smart product recommendations** and substitutions
- 📊 **Advanced analytics** and reporting
- 🎮 **Gamification features** to engage users
- 🌱 **Sustainability scoring** for eco-conscious shopping
- 📧 **Automated email notifications** and PDF reports
- ⚡ **High-performance architecture** with caching and background processing

Start building amazing retail experiences! 🎊
